



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Learning How to Program in SAS">
      
      
      
        <meta name="author" content="Lucía Rodrigo Insausti">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Propensity Score - SAS Manual</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#propensity-score" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="SAS Manual" aria-label="SAS Manual" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SAS Manual
            </span>
            <span class="md-header-nav__topic">
              
                Propensity Score
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="SAS Manual" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    SAS Manual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Gettin' Started!" class="md-nav__link">
      Gettin' Started!
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      The Essentials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        The Essentials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/accessing/" title="Accessing Data" class="md-nav__link">
      Accessing Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/reporting/" title="Producing Detailed Reports" class="md-nav__link">
      Producing Detailed Reports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/formatting/" title="Formatting Data Values" class="md-nav__link">
      Formatting Data Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/reading-sas/" title="Reading SAS Data Sets" class="md-nav__link">
      Reading SAS Data Sets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/reading-spreadsheets/" title="Reading Spreadsheet and Database Data" class="md-nav__link">
      Reading Spreadsheet and Database Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/reading-raw/" title="Reading Raw Data Files" class="md-nav__link">
      Reading Raw Data Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/manipulation/" title="Manipulating Data" class="md-nav__link">
      Manipulating Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/combination/" title="Combining SAS Data Sets" class="md-nav__link">
      Combining SAS Data Sets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../essentials/summary/" title="Creating Summary Reports" class="md-nav__link">
      Creating Summary Reports
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Basic Statistics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Basic Statistics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/anova/" title="Analysis of Variance (ANOVA)" class="md-nav__link">
      Analysis of Variance (ANOVA)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/regression/" title="Regression" class="md-nav__link">
      Regression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/inference/" title="Model Post-Fitting for Inference" class="md-nav__link">
      Model Post-Fitting for Inference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/categorical-data/" title="Categorical Data Analysis" class="md-nav__link">
      Categorical Data Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/prediction/" title="Model Building and Scoring for Prediction" class="md-nav__link">
      Model Building and Scoring for Prediction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/miscellanea/" title="Miscellanea" class="md-nav__link">
      Miscellanea
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Using Macros
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Using Macros
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/introducing-macrovar/" title="Introducing Macro Variables" class="md-nav__link">
      Introducing Macro Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/using-macrofunc/" title="Using Macro Functions" class="md-nav__link">
      Using Macro Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/macrovar-at-execution-time/" title="Creating Macro Variables at Execution Time" class="md-nav__link">
      Creating Macro Variables at Execution Time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/macroprog/" title="Creating and Using Macro Programs" class="md-nav__link">
      Creating and Using Macro Programs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/macroprog-processing/" title="Using Conditional and Iterative Processing in Macro Programs" class="md-nav__link">
      Using Conditional and Iterative Processing in Macro Programs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/debugging-options/" title="Debugging Options" class="md-nav__link">
      Debugging Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macros/more-macro/" title="More on Macro Programming" class="md-nav__link">
      More on Macro Programming
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/getting-started/" title="Getting Started with the SQL Procedure" class="md-nav__link">
      Getting Started with the SQL Procedure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/efficiencies/" title="Measuring Efficiencies" class="md-nav__link">
      Measuring Efficiencies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/displaying-results/" title="Displaying Query Results" class="md-nav__link">
      Displaying Query Results
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/joins/" title="Working with SQL Joins" class="md-nav__link">
      Working with SQL Joins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/nested-queries/" title="Working with Nested Queries" class="md-nav__link">
      Working with Nested Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/set-operators/" title="Working with Set Operators" class="md-nav__link">
      Working with Set Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/tables-views/" title="Creating Tables and Views" class="md-nav__link">
      Creating Tables and Views
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/advanced/" title="Using Advanced PROC SQL Features" class="md-nav__link">
      Using Advanced PROC SQL Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sql/miscellanea/" title="Miscellanea" class="md-nav__link">
      Miscellanea
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Other Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Other Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../model-selection/" title="Model Selection" class="md-nav__link">
      Model Selection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../missing-data/" title="Dealing with Missing Data" class="md-nav__link">
      Dealing with Missing Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interim-analysis/" title="Interim Analysis Design" class="md-nav__link">
      Interim Analysis Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../normality-tests/" title="Normality Tests" class="md-nav__link">
      Normality Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../post-hoc-tests/" title="Post-hoc Tests" class="md-nav__link">
      Post-hoc Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adjusted-pvalue/" title="Adjusted P-value" class="md-nav__link">
      Adjusted P-value
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../effect-size/" title="Effect Size" class="md-nav__link">
      Effect Size
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Propensity Score
      </label>
    
    <a href="./" title="Propensity Score" class="md-nav__link md-nav__link--active">
      Propensity Score
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#propensity-score" class="md-nav__link">
    Propensity Score
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-it" class="md-nav__link">
    What is it?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-propensity-score" class="md-nav__link">
    Computing the Propensity Score
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#propensity-score-matching" class="md-nav__link">
    Propensity Score Matching
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pair-matching-methods" class="md-nav__link">
    Pair-matching Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods-without-replacement" class="md-nav__link">
    Methods without Replacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods-with-replacement" class="md-nav__link">
    Methods with Replacement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-to-n-matching-methods" class="md-nav__link">
    1 to N Matching Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#radius-matching" class="md-nav__link">
    Radius Matching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mahalanobis-metric-matching" class="md-nav__link">
    Mahalanobis Metric Matching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psmatching-macro" class="md-nav__link">
    PSMatching Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc-psmatch" class="md-nav__link">
    PROC PSMATCH
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stratification-on-the-propensity-score" class="md-nav__link">
    Stratification on the Propensity Score
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../roc-curve/" title="ROC Curve" class="md-nav__link">
      ROC Curve
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../questionnaires/" title="Questionnaires analysis" class="md-nav__link">
      Questionnaires analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sequence-design/" title="Sequence Design" class="md-nav__link">
      Sequence Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../survival-analysis/" title="Survival Analysis" class="md-nav__link">
      Survival Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../HR_vs_OR_vs_RR/" title="Odds Ratio, Hazard Ratio and Relative Risk" class="md-nav__link">
      Odds Ratio, Hazard Ratio and Relative Risk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clustering/" title="Clustering" class="md-nav__link">
      Clustering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../randomization/" title="Randomization" class="md-nav__link">
      Randomization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Specific Procedures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Specific Procedures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../procedures/regression-models/" title="General Notes on Regression Procedures" class="md-nav__link">
      General Notes on Regression Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../procedures/glimmix/" title="PROC GLIMMIX" class="md-nav__link">
      PROC GLIMMIX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../procedures/mixed/" title="PROC MIXED" class="md-nav__link">
      PROC MIXED
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      SAS Outputs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        SAS Outputs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/ods/" title="Output Delivery System" class="md-nav__link">
      Output Delivery System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/graphs/" title="Graphs and Plots" class="md-nav__link">
      Graphs and Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/print/" title="PROC PRINT" class="md-nav__link">
      PROC PRINT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/report/" title="PROC REPORT" class="md-nav__link">
      PROC REPORT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/tabulate/" title="PROC TABULATE" class="md-nav__link">
      PROC TABULATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/template/" title="PROC TEMPLATE" class="md-nav__link">
      PROC TEMPLATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/pdf/" title="Write to pdf file" class="md-nav__link">
      Write to pdf file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sas-outputs/excel/" title="Export to Excel file" class="md-nav__link">
      Export to Excel file
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      SAS CDI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        SAS CDI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../SAS-CDI/intro-CDISC/" title="What is CDISC?" class="md-nav__link">
      What is CDISC?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../SAS-CDI/sdtm/" title="SDTM Basics" class="md-nav__link">
      SDTM Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../SAS-CDI/intro-CDI/" title="Introduction to CDI" class="md-nav__link">
      Introduction to CDI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      SAS vs R
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        SAS vs R
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/importing-reporting/" title="Importing and Reporting Data" class="md-nav__link">
      Importing and Reporting Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/variables-functions/" title="Creating New Variables, Functions and Data Tables" class="md-nav__link">
      Creating New Variables, Functions and Data Tables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/random-plotting/" title="Random Number Generation and Plotting" class="md-nav__link">
      Random Number Generation and Plotting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/proc-ods-macros/" title="Descriptive Procedures, Output Delivery System and Macros" class="md-nav__link">
      Descriptive Procedures, Output Delivery System and Macros
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/inferential/" title="Analyzing the Data via Inferential Procedures" class="md-nav__link">
      Analyzing the Data via Inferential Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/iml/" title="Interactive Matrix Language (IML)" class="md-nav__link">
      Interactive Matrix Language (IML)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sasvsr/bridge/" title="A Bridge Between SAS and R" class="md-nav__link">
      A Bridge Between SAS and R
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../wizard/" title="Using Wizard Menus" class="md-nav__link">
      Using Wizard Menus
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../sasvi/" title="SAS Visual Analytics" class="md-nav__link">
      SAS Visual Analytics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Miscellanea
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Miscellanea
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/arrays/" title="Working with Arrays" class="md-nav__link">
      Working with Arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/execution-time/" title="Execution time" class="md-nav__link">
      Execution time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/time-intervals/" title="Time intervals" class="md-nav__link">
      Time intervals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/patient-identification/" title="Patient identification" class="md-nav__link">
      Patient identification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/random-list/" title="Generating a Random List" class="md-nav__link">
      Generating a Random List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellanea/shell/" title="Shell Scripting in SAS" class="md-nav__link">
      Shell Scripting in SAS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Medical terms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Medical terms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/labs/" title="Laboratory Test" class="md-nav__link">
      Laboratory Test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/exposure/" title="Treatment Exposure" class="md-nav__link">
      Treatment Exposure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/orr-dcr/" title="ORR and DCR" class="md-nav__link">
      ORR and DCR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/sensitivity-specificity/" title="Sensitivity and Specificity" class="md-nav__link">
      Sensitivity and Specificity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/recist/" title="RECIST v1.1" class="md-nav__link">
      RECIST v1.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/irecist/" title="iRECIST" class="md-nav__link">
      iRECIST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../medical/mutations/" title="Mutations" class="md-nav__link">
      Mutations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      R with Shiny
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        R with Shiny
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../R-with-Shiny/introduction/" title="Introduction and Shiny Basics" class="md-nav__link">
      Introduction and Shiny Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../R-with-Shiny/input-output/" title="Inputs, Outputs, and Rendering Functions" class="md-nav__link">
      Inputs, Outputs, and Rendering Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../R-with-Shiny/reactive/" title="Reactive Programming" class="md-nav__link">
      Reactive Programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../R-with-Shiny/custom/" title="Customizing Appearance" class="md-nav__link">
      Customizing Appearance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#propensity-score" class="md-nav__link">
    Propensity Score
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-it" class="md-nav__link">
    What is it?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-propensity-score" class="md-nav__link">
    Computing the Propensity Score
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#propensity-score-matching" class="md-nav__link">
    Propensity Score Matching
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pair-matching-methods" class="md-nav__link">
    Pair-matching Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods-without-replacement" class="md-nav__link">
    Methods without Replacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods-with-replacement" class="md-nav__link">
    Methods with Replacement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-to-n-matching-methods" class="md-nav__link">
    1 to N Matching Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#radius-matching" class="md-nav__link">
    Radius Matching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mahalanobis-metric-matching" class="md-nav__link">
    Mahalanobis Metric Matching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psmatching-macro" class="md-nav__link">
    PSMatching Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc-psmatch" class="md-nav__link">
    PROC PSMATCH
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stratification-on-the-propensity-score" class="md-nav__link">
    Stratification on the Propensity Score
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Propensity Score</h1>
                
                <h2 id="propensity-score">Propensity Score<a class="headerlink" href="#propensity-score" title="Permanent link">Link</a></h2>
<h3 id="what-is-it">What is it?<a class="headerlink" href="#what-is-it" title="Permanent link">Link</a></h3>
<p>The objective of randomization in statistics is to obtain groups that are comparable in terms of both observed and unobserved characteristics. When randomization is not possible, causal inference is complicated by the fact that a group that received a treatment or experienced an event maybe very different from another group that did not experience the event or receive the treatment. Thus, it is <strong>not clear whether a difference in certain outcome of interest is due to the treatment or is the product of prior differences among groups</strong>. Propensity score methods were developed to facilitate the <strong>creation of comparison groups that are similar in terms of the distribution of observed characteristics</strong>.</p>
<p>The first step involves estimating the likelihood (the propensity score) that a person would have received the treatment given certain characteristics. More formally, the propensity score is the <strong>conditional probability of assignment to a particular treatment given a vector of observed covariates</strong>. Two key assumptions of propensity scores are that <strong>both the outcome of interest and the treatment assignment do not depend on unobservable characteristics</strong>.</p>
<h3 id="computing-the-propensity-score">Computing the Propensity Score<a class="headerlink" href="#computing-the-propensity-score" title="Permanent link">Link</a></h3>
<p>In order to program the corresponding model in SAS, the response variable is the group/arm to which the patient belongs and the predictors are all the baseline variables which could affect the assignment to a certain group. While the model is fitted the propensity score value can be computed and kept in an output:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">PROC</span> <span class="n">LOGISTIC</span> <span class="k">DATA</span><span class="o">=</span><span class="k">input</span><span class="o">-</span><span class="n">SAS</span><span class="o">-</span><span class="k">data</span><span class="o">-</span><span class="k">set</span><span class="p">;</span>
    <span class="k">CLASS</span> <span class="n">sex</span> <span class="n">site</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="k">ref</span><span class="p">);</span>
    <span class="n">MODEL</span> <span class="n">arm</span> <span class="o">=</span> <span class="n">sex</span> <span class="n">age</span> <span class="n">weight</span> <span class="n">site</span> <span class="n">serologytests</span> <span class="o">/</span> <span class="n">FIRTH</span><span class="p">;</span>
    <span class="k">OUTPUT</span> <span class="k">OUT</span><span class="o">=</span><span class="k">output</span><span class="o">-</span><span class="n">SAS</span><span class="o">-</span><span class="k">data</span><span class="o">-</span><span class="k">set</span> <span class="n">PROB</span><span class="o">=</span><span class="n">ps</span><span class="o">-</span><span class="k">variable</span><span class="o">-</span><span class="n">customized</span><span class="o">-</span><span class="n">name</span><span class="p">;</span>
<span class="n">RUN</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

<p>This kind of analysis are commonly used in observacional studies on which the patient is not randomized to a certain group but it belongs to it due to a certain diagnostic. In order to correct the possible effect of unbalanced population groups, <strong>the propensity score value can be included in the model</strong> as a way to isolate the effects due to the treatment from the baseline characteristics.</p>
<h2 id="propensity-score-matching">Propensity Score Matching<a class="headerlink" href="#propensity-score-matching" title="Permanent link">Link</a></h2>
<p>After estimating the propensity scores, they are used to group observations that are close to each other. One way of
accomplishing this is to classify treated and untreated observations into subgroups and then separately compare the outcome
for each subgroup. This method is usually referred as <strong>subclassification on the propensity scores</strong> (Rosenbaum and Rubin
1984). The other way is to match one treated unit to one or more untreated controls, which is usually referred as <strong>matching on
the propensity score</strong> (Rosenbaum and Rubin 1983).</p>
<p>Key in the implementation of matching using propensity scores is to <strong>decide what metric to use when evaluating the distance between scores</strong> (usually the absolute value or the Mahalanobis metric) and <strong>what type of algorithm to implement</strong> (local or global optimal).</p>
<h3 id="pair-matching-methods">Pair-matching Methods<a class="headerlink" href="#pair-matching-methods" title="Permanent link">Link</a></h3>
<p>The most common implementation is 1:1 (1 to 1) or pair-matching in which pairs of treated and untreated subjects are formed which allows to estimate for average treatment effect in the treated (ATT).</p>
<h4 id="methods-without-replacement">Methods without Replacement<a class="headerlink" href="#methods-without-replacement" title="Permanent link">Link</a></h4>
<p>We match each untreated subject to at most one treated subject. Once an untreated subject has been matched to a treated subject, that untreated subject is no longer eligible for consideration as a match for other treated subjects.</p>
<ul>
<li>Global optimal matching: forms matched pairs so as to minimize the average within-pair difference in propensity scores</li>
<li>Local optimal, greedy or nearest available neighbor matching: selects a treated subject and then selects as a matched control subject the one whose propensity score is closest to that of the treated subject (if multiple untreated subjects are equally close to the treated subject, one of these untreated subjects is selected at random). In each iteration, the best (optimal) control is chosen, but this process does not guarantee that the total distance between propensity scores is minimized.</li>
</ul>
<p>Four different approaches:</p>
<ul>
<li>Sequentially treated subjects from highest to lowest propensity score</li>
<li>Sequentially treated subjects from lowest to highest propensity score</li>
<li>Sequentially treated subjects in the order of the best possible match (the first selected treated subject is that treated subject who is closest to an untreated subject and so on)</li>
<li>Treated subjects in a random order</li>
<li>Local optimal, greedy or nearest available neighbour matching within specified caliper widths: we can match treated and untreated subjects only if the absolute difference in their propensity scores is within a prespecified maximal distance (the caliper distance, defined as a proportion of the standard deviation of the logit of the propensity score)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the propensity score is the natural metric to use, when using caliper matching, a reduction in bias due to the use of different caliper widths has been described when matching on the logit of the propensity score.
Although it is difficult to know beforehand the optimal choice of caliper width, some researchers (Rosenbuam &amp; Rubin, 1985; Austin, 2011) have recommended using a caliper width that is equal to 0.2 of the standard deviation of the logit of the propensity score, i.e., $0.2\cdot\sqrt\left ( \sigma^2_1+\sigma^2_2 \right )/2$.</p>
</div>
<ul>
<li>Sequentially treated subjects from highest to lowest propensity score</li>
<li>Sequentially treated subjects from lowest to highest propensity score</li>
<li>Sequentially treated subjects in the order of the best possible match (the first selected treated subject is that treated subject who is closest to an untreated subject and so on)</li>
<li>Treated subjects in a random order</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Optimal matching and greedy nearest neighbor matching on the propensity score will result in all treated subjects being matched to an untreated subject (assuming that the number of untreated subjects is at least as large as the number of treated subjects). However, greedy nearest neighbor matching within specified caliper widths may not result in all treated subjects being matched to an untreated subject, because for some treated subjects, there may not be any untreated subjects who are unmatched and whose propensity score lies within the specified caliper distance of that of the treated subject. The objective of the caliper matching is to avoid bad matches.</p>
</div>
<h4 id="methods-with-replacement">Methods with Replacement<a class="headerlink" href="#methods-with-replacement" title="Permanent link">Link</a></h4>
<p>Permits the same untreated subject to be matched to multiple treated subjects (because untreated subjects are recycled or allowed to be included in multiple matched sets, the order in which the treated subjects are selected has no effect on the formation of matched pairs). Matching with replacement minimizes the propensity score distance between the matched units since each treated unit is matched to the closest control, even if the control has been selected before.</p>
<ul>
<li>Nearest neighbor matching with replacement: matches each treated subject to the nearest untreated subject</li>
<li>Nearest neighbor matching within specified caliper widths with replacement: matches each treated subject to the nearest untreated subject (subject to possible caliper restrictions)</li>
</ul>
<h3 id="1-to-n-matching-methods">1 to N Matching Methods<a class="headerlink" href="#1-to-n-matching-methods" title="Permanent link">Link</a></h3>
<p>They include matching each treated unit to more than one control match. This can be done by creating N replicas of each treated unit and proceeding as described above. </p>
<h3 id="radius-matching">Radius Matching<a class="headerlink" href="#radius-matching" title="Permanent link">Link</a></h3>
<p>All the control units within a certain distance are chosen (Dehejia and Wahba 1999).</p>
<h3 id="mahalanobis-metric-matching">Mahalanobis Metric Matching<a class="headerlink" href="#mahalanobis-metric-matching" title="Permanent link">Link</a></h3>
<p>In this type of matching, the definition of distance is changed. The similarity between the propensity score of treated and untreated units is evaluated using the multidimensional Mahalanobis metric matching:</p>
<p>$D_{ij}=\sqrt{\left ( x_i-y_j \right )^TS^{-1}\left ( x_i-y_j \right )}$</p>
<p>where $S^{-1}$ is the pooled variance-covariance matrix and x and y are multivariate vectors. Note that if the variance-covariance
matrix is an identity matrix the Mahalanobis metric is reduced to the familiar Euclidean metric. Usually the Mahalanobis metric
matching includes the propensity score and other covariates that are considered to be important and are hoped to be balanced
(Rosenbaum and Rubin 1985).</p>
<h3 id="psmatching-macro">PSMatching Macro<a class="headerlink" href="#psmatching-macro" title="Permanent link">Link</a></h3>
<p>With the macro <a href="http://www2.sas.com/proceedings/forum2007/185-2007.pdf"><code>PSMatching.sas</code></a> (Coca-Perraillon, 2006) different methods can be applied to calculate the matching once you have the propensity score. First you have to prepare the following input:</p>
<ul>
<li><code>Treatment</code> data set containing the treatment cases along with the patient number <code>idT</code> and the corresponding propensity score <code>pscoreT</code></li>
<li><code>Control</code> data set containing the control cases along with the patient number <code>idC</code> and the corresponding propensity score <code>pscoreC</code></li>
</ul>
<p>The parameters <code>datatreatment</code> and <code>datacontrol</code> refer to the Treatment and Control datasets and they do not need to be sorted.
The method parameter can be <code>NN</code> (nearest available neighbor), <code>caliper</code> or <code>radius</code>. Caliper can be any number indicating the
size of the <code>caliper</code> and the parameter <code>replacement</code> takes the values of yes or no. All the parameters are case insensitive. If the
method is <code>NN</code>, the caliper parameter is ignored.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c">%PSMatching(datatreatment=treatment, datacontrol=control, method=caliper, numberofcontrols=1, caliper=0.2, replacement=no);</span>
</code></pre></div>
</td></tr></table>

<p>Here is the macro code:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nf">%macro</span> <span class="n">PSMatching</span><span class="p">(</span><span class="n">datatreatment</span><span class="o">=</span><span class="p">,</span> <span class="n">datacontrol</span><span class="o">=</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">,</span> <span class="n">numberofcontrols</span><span class="o">=</span><span class="p">,</span> <span class="n">caliper</span><span class="o">=</span><span class="p">,</span><span class="n">replacement</span><span class="o">=</span><span class="p">);</span>

<span class="cm">/* Create copies of the treated units if N &gt; 1 */</span><span class="p">;</span>
<span class="n">data</span> <span class="nf">_Treatment0</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span> <span class="n">i</span><span class="p">);</span>
<span class="n">set</span> <span class="n">Treatment</span><span class="p">;</span>
<span class="k">do</span> <span class="n">i</span><span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="o">&amp;</span><span class="n">numberofcontrols</span><span class="p">;</span>
<span class="n">RandomNumber</span><span class="o">=</span> <span class="n">ranuni</span><span class="p">(</span><span class="mi">12345</span><span class="p">);</span>
<span class="n">output</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="n">run</span><span class="p">;</span>

<span class="cm">/* Randomly sort both datasets */</span>
<span class="n">proc</span> <span class="n">sort</span> <span class="n">data</span><span class="o">=</span> <span class="n">_Treatment0</span> <span class="n">out</span><span class="o">=</span> <span class="n">_Treatment</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span> <span class="n">RandomNumber</span><span class="p">);</span>
<span class="n">by</span> <span class="n">RandomNumber</span><span class="p">;</span>
<span class="n">run</span><span class="p">;</span>
<span class="n">data</span> <span class="n">_Control0</span><span class="p">;</span>
<span class="n">set</span> <span class="n">Control</span><span class="p">;</span>
<span class="n">RandomNumber</span><span class="o">=</span> <span class="n">ranuni</span><span class="p">(</span><span class="mi">45678</span><span class="p">);</span>
<span class="n">run</span><span class="p">;</span>
<span class="n">proc</span> <span class="n">sort</span> <span class="n">data</span><span class="o">=</span> <span class="n">_Control0</span> <span class="n">out</span><span class="o">=</span> <span class="n">_Control</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span> <span class="n">RandomNumber</span><span class="p">);</span>
<span class="n">by</span> <span class="n">RandomNumber</span><span class="p">;</span>
<span class="n">run</span><span class="p">;</span>
<span class="n">data</span> <span class="nf">Matched</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="n">IdSelectedControl</span> <span class="n">MatchedToTreatID</span><span class="p">);</span>
<span class="n">length</span> <span class="n">pscoreC</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">length</span> <span class="n">idC</span> <span class="mi">8</span><span class="p">;</span>

<span class="cm">/* Load Control dataset into the hash object */</span>
<span class="k">if</span> <span class="n">_N_</span><span class="o">=</span> <span class="mi">1</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">declare</span> <span class="n">hash</span> <span class="nf">h</span><span class="p">(</span><span class="nl">dataset</span><span class="p">:</span> <span class="s">&quot;_Control&quot;</span><span class="p">,</span> <span class="nl">ordered</span><span class="p">:</span> <span class="err">&#39;</span><span class="n">no</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">declare</span> <span class="n">hiter</span> <span class="nf">iter</span><span class="p">(</span><span class="sc">&#39;h&#39;</span><span class="p">);</span>
<span class="n">h</span><span class="p">.</span><span class="n">defineKey</span><span class="p">(</span><span class="err">&#39;</span><span class="n">idC</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">h</span><span class="p">.</span><span class="n">defineData</span><span class="p">(</span><span class="err">&#39;</span><span class="n">pscoreC</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">idC</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">h</span><span class="p">.</span><span class="n">defineDone</span><span class="p">();</span>
<span class="n">call</span> <span class="nf">missing</span><span class="p">(</span><span class="n">idC</span><span class="p">,</span> <span class="n">pscoreC</span><span class="p">);</span>
<span class="n">end</span><span class="p">;</span>

<span class="cm">/* Open the treatment */</span>
<span class="n">set</span> <span class="n">_Treatment</span><span class="p">;</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">~=</span> <span class="n">RADIUS</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="n">retain</span> <span class="n">BestDistance</span> <span class="mi">99</span><span class="p">;</span>
<span class="nf">%end</span><span class="p">;</span>

<span class="cm">/* Iterate over the hash */</span>
<span class="n">rc</span><span class="o">=</span> <span class="n">iter</span><span class="p">.</span><span class="n">first</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="n">then</span> <span class="n">BestDistance</span><span class="o">=</span> <span class="mi">99</span><span class="p">;</span>
<span class="k">do</span> <span class="nf">while</span> <span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

<span class="cm">/* Caliper */</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">=</span> <span class="n">CALIPER</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">pscoreT</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">caliper</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">pscoreC</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">pscoreT</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">caliper</span><span class="p">)</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">ScoreDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pscoreT</span> <span class="o">-</span> <span class="n">pscoreC</span><span class="p">);</span>
<span class="k">if</span> <span class="n">ScoreDistance</span> <span class="o">&lt;</span> <span class="n">BestDistance</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">BestDistance</span> <span class="o">=</span> <span class="n">ScoreDistance</span><span class="p">;</span>
<span class="n">IdSelectedControl</span> <span class="o">=</span> <span class="n">idC</span><span class="p">;</span>
<span class="n">MatchedToTreatID</span> <span class="o">=</span> <span class="n">idT</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="nf">%end</span><span class="p">;</span>

<span class="cm">/* NN */</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">=</span> <span class="n">NN</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="n">ScoreDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pscoreT</span> <span class="o">-</span> <span class="n">pscoreC</span><span class="p">);</span>
<span class="k">if</span> <span class="n">ScoreDistance</span> <span class="o">&lt;</span> <span class="n">BestDistance</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">BestDistance</span> <span class="o">=</span> <span class="n">ScoreDistance</span><span class="p">;</span>
<span class="n">IdSelectedControl</span> <span class="o">=</span> <span class="n">idC</span><span class="p">;</span>
<span class="n">MatchedToTreatID</span> <span class="o">=</span> <span class="n">idT</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="nf">%end</span><span class="p">;</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">=</span> <span class="n">NN</span> <span class="n">or</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">=</span> <span class="n">CALIPER</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

<span class="cm">/* Output the best control and remove it */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">~=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">and</span> <span class="n">BestDistance</span> <span class="o">~=</span><span class="mi">99</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">output</span><span class="p">;</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">replacement</span><span class="p">)</span> <span class="o">=</span> <span class="n">NO</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="n">rc1</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="nl">key</span><span class="p">:</span> <span class="n">IdSelectedControl</span><span class="p">);</span>
<span class="nf">%end</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="nf">%end</span><span class="p">;</span>

<span class="cm">/* Radius */</span>
<span class="nf">%if</span> <span class="nf">%upcase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">method</span><span class="p">)</span> <span class="o">=</span> <span class="n">RADIUS</span> <span class="nf">%then</span> <span class="nf">%do</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">pscoreT</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">caliper</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">pscoreC</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">pscoreT</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">caliper</span><span class="p">)</span> <span class="n">then</span> <span class="k">do</span><span class="p">;</span>
<span class="n">IdSelectedControl</span> <span class="o">=</span> <span class="n">idC</span><span class="p">;</span>
<span class="n">MatchedToTreatID</span> <span class="o">=</span> <span class="n">idT</span><span class="p">;</span>
<span class="n">output</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="nf">%end</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
<span class="n">run</span><span class="p">;</span>

<span class="cm">/* Delete temporary tables. Quote for debugging */</span>
<span class="n">ods</span> <span class="n">select</span> <span class="n">none</span><span class="p">;</span>
<span class="n">proc</span> <span class="n">datasets</span><span class="p">;</span>
<span class="k">delete</span> <span class="nl">_</span><span class="p">:(</span><span class="n">gennum</span><span class="o">=</span><span class="n">all</span><span class="p">);</span>
<span class="n">run</span><span class="p">;</span>
<span class="n">ods</span> <span class="n">select</span> <span class="n">all</span><span class="p">;</span>

<span class="nf">%mend</span> <span class="n">PSMatching</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

<h3 id="proc-psmatch"><code>PROC PSMATCH</code><a class="headerlink" href="#proc-psmatch" title="Permanent link">Link</a></h3>
<p><a href="http://documentation.sas.com/?docsetId=statug&amp;docsetVersion=14.2&amp;docsetTarget=statug_psmatch_overview.htm&amp;locale=en">Here</a> and <a href="https://support.sas.com/documentation/onlinedoc/stat/142/psmatch.pdf">here</a> you can find the documentation of this procedure. </p>
<h2 id="stratification-on-the-propensity-score">Stratification on the Propensity Score<a class="headerlink" href="#stratification-on-the-propensity-score" title="Permanent link">Link</a></h2>
<p>Stratification on the propensity score involves <strong>stratifying subjects into mutually exclusive subsets based on their estimated propensity score</strong>. Subjects are ranked according to their estimated propensity score. Subjects are then stratified into subsets based on previously defined thresholds of the estimated propensity score. A common approach is to <strong>divide subjects into five equal-size groups using the quintiles of the estimated propensity score</strong>. Rosenbaum and Rubin (1984) stated that stratifying on the quintiles of the propensity score eliminates approximately 90% of the bias due to measured confounders when estimating a linear treatment effect. Within each propensity score stratum, treated and untreated subjects will have roughly similar values of the propensity score. Therefore, when the propensity score has been correctly specified, the distribution of measured baseline covariates will be approximately similar between treated and untreated subjects within the same stratum.</p>
<p>More info on this topic <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/">here</a>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../effect-size/" title="Effect Size" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Effect Size
              </span>
            </div>
          </a>
        
        
          <a href="../roc-curve/" title="ROC Curve" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ROC Curve
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../js/mathjaxhelper.js"></script>
      
    
  </body>
</html>